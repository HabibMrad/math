<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Notes on Raney's Lemmas</title>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
    <style>
      body    { font-size: 120%; }
      table   { margin: auto; }
      code    { white-space: pre; }
      q       { quotes: "“" "”" "‘" "’"; }
      h1      { font-size: 1.5em; }
      h2      { font-size: 1.17em; }
      .title  { font-size: 2em; font-weight: bold; }
      .author { color: #AAA; line-height: 150%; }
      .date   { color: #AAA; line-height: 150%; font-size: 0.8em; }
    </style>
  </head>
  <body>
    <div style="width:760px;margin:auto">
      <div class="title">Notes on Raney's Lemmas</div>
      <div class="author">Tyler Neylon</div>
      <div class="date">251.2015</div>
      <p>In a 1960 paper, George Raney proved the first two lemmas below; the lemmas suppose we have a finite sequence of numbers meeting certain constraints, and provide the number of cycle shifts that contain all-positive partial sums <span class="citation">(Raney 1960)</span>.</p>
      <p>These notes expand on the ideas behind these lemmas. The final section of these notes discusses cyclic shifts for finite sequences of independent, uniformly random values; as far as I know, the work in that section is new.</p>
      <p>I personally learned of these lemmas in chapter 7 of the book <em>Concrete Mathematics</em> <span class="citation">(Knuth, Patashnik, and Graham 1998)</span>, which explores their applications to generating functions. The presentation of the lemmas here is based on the presentation in <em>Concrete Mathematics</em> rather than on Raney's original paper.</p>
      <h1 id="integer-sequences"><span class="header-section-number">1</span> Integer sequences</h1>
      <p><strong>Lemma 1</strong>  <em>Suppose <span class="math">\(\sum_{i=1}^n x_i = 1\)</span>, where all <span class="math">\(x_i\in\mathbb{Z}\)</span>. Extend the sequence by letting <span class="math">\(x_{n+p}=x_p\)</span> for <span class="math">\(1\le p\le n\)</span>. Then there is a unique <span class="math">\(j\)</span>, <span class="math">\(1 \le j \le n\)</span>, such that</em></p>
      <p><span class="math">\[\sum_{i=j}^{j+k-1} x_i &gt; 0; \quad 1 \le k \le n.\]</span></p>
      <hr />
      <p>Intuitively, we can think of such an index <span class="math">\(j\)</span> as a cyclic shift of the sequence that has partial sums that are all positive.</p>
      <p>For example, the finite sequence <span class="math">\(\langle x_1, \ldots, x_5\rangle = \langle 3, -2, 4, -1, 1 \rangle\)</span> offers <span class="math">\(j=5\)</span> as the unique shift providing <span class="math">\(\langle x_5, x_6=x_1, \ldots, x_9=x_4\rangle = \langle 1, 3, -2, 4, -5\rangle\)</span> with partial sums <span class="math">\(\langle 1, 4, 2, 6, 1\rangle\)</span> that are all positive.</p>
      <p><strong>Definitions</strong>  Given a sequence <span class="math">\(\langle x_1, \ldots, x_n\rangle\)</span>, it's useful to say that an index <span class="math">\(i \in \{1,\ldots, n\}\)</span> is a <em>positive-sum shift</em> if and only if the partial sums of <span class="math">\(\langle x_i, \ldots, x_n, x_1, \ldots, x_{i-1}\rangle\)</span> are all positive. Since these notes focus on finite sequences, we'll implicitly use arbitrary indexes <span class="math">\(x_j, j\in\mathbb{Z}\)</span>, to refer to <span class="math">\(x_k\)</span> with <span class="math">\(k\in \{1, \ldots, n\}, k\equiv j \pmod n\)</span>.</p>
      <p>We'll use the subscript-free letter <span class="math">\(x\)</span> to denote an entire finite sequence <span class="math">\(\langle x_1, \ldots, x_n\rangle\)</span>. We'll write <span class="math">\(\sigma(x)\)</span> to indicate the number of indexes of <span class="math">\(x\)</span> that are positive-sum shifts.</p>
      <p>We can now concisely state a related result proved by Raney:</p>
      <p><strong>Lemma 2</strong>  <em>Suppose <span class="math">\(\sum_{i=1}^nx_i=\ell\)</span>, where <span class="math">\(x_i\in\mathbb{Z}\)</span> and <span class="math">\(x_i \le 1\)</span> for all <span class="math">\(i\)</span>. Then <span class="math">\(\sigma(x) = \ell\)</span>; that is, exactly <span class="math">\(\ell\)</span> indexes in <span class="math">\(\{1, \ldots, n\}\)</span> are positive-sum shifts.</em></p>
      <hr />
      <p>For example, let <span class="math">\(\langle x_1, \ldots, x_8\rangle = \langle -2, 1, 1, 0, -1, 1, 1, 1\rangle\)</span>. Then <span class="math">\(\sum x_i = 2\)</span>, and <span class="math">\(x_2, x_6\)</span> are the only positive-sum shifts:</p>
      <table>
      <thead>
      <tr class="header">
      <th align="left">shift</th>
      <th align="left">partial sums</th>
      </tr>
      </thead>
      <tbody>
      <tr class="odd">
      <td align="left"><span class="math">\(\langle x_2, \ldots\rangle = \langle 1, 1, 0, -1, 1, 1, 1, -2\rangle\quad\)</span></td>
      <td align="left"><span class="math">\(\langle 1, 2, 2, 1, 2, 3, 4, 2\rangle\)</span></td>
      </tr>
      <tr class="even">
      <td align="left"><span class="math">\(\langle x_6, \ldots\rangle = \langle 1, 1, 1, -2, 1, 1, 0, -1\rangle\quad\)</span></td>
      <td align="left"><span class="math">\(\langle 1, 2, 3, 1, 2, 3, 3, 2\rangle\)</span></td>
      </tr>
      </tbody>
      </table>
      <p>Note that lemma 2 is not a strict generalization of lemma 1 as it adds the condition <span class="math">\(x_i \le 1\)</span>. This condition is necessary for lemma 2; without it we may have, for example, the one-element sequence <span class="math">\(x = \langle 2\rangle\)</span> with sum <span class="math">\(\ell = 2\)</span> and <span class="math">\(\sigma(x) = 1\)</span>.</p>
      <p>Rather than proving the above two lemmas directly, we'll jump to the general case of real sequences <span class="math">\(x\)</span> and prove strictly more general bounds on <span class="math">\(\sigma(x)\)</span> in that context.</p>
      <h1 id="real-sequences"><span class="header-section-number">2</span> Real sequences</h1>
      <p>We start with a general guarantee that <span class="math">\(\sum x_i &gt; 0 \Rightarrow \sigma(x) \ge 1\)</span>. In the context of a sequence <span class="math">\(x\)</span>, it will be useful to write <span class="math">\(s_i\)</span> to denote the <span class="math">\(i^\mathrm{th}\)</span> partial sum of <span class="math">\(x\)</span>; that is, <span class="math">\(s_0 = 0\)</span>, and <span class="math">\[ s_i = \sum_{j=1}^i x_j, \quad \text{for } i \ge 1. \]</span> We can define <span class="math">\(s_i\)</span> for <span class="math">\(i &gt; n\)</span> using the implicitly periodic sequence characterized by <span class="math">\(x_{n + i} = x_i\)</span>.</p>
      <p><strong>Property 3</strong>  <em>Suppose <span class="math">\(\sum_{i=1}^nx_i &gt; 0\)</span>, where <span class="math">\(x_i\in\mathbb{R}\)</span>. Let <span class="math">\(s_i\)</span> denote the <span class="math">\(i^\mathrm{th}\)</span> partial sum of <span class="math">\(x\)</span>, and let <span class="math">\(j\)</span> be the largest index in <span class="math">\(\{1, \ldots, n\}\)</span> with <span class="math">\(s_{j-1} = \min_{0\le i &lt; n} s_i\)</span>. Then <span class="math">\(j\)</span> is a positive-sum shift.</em></p>
      <hr />
      <p><strong>Proof</strong>  Let <span class="math">\[s&#39;_i = \sum_{k=j}^{j+i-1}x_k\]</span> denote the <span class="math">\(i^\mathrm{th}\)</span> partial sum of the shifted sequence <span class="math">\(\langle x_j, \ldots, x_{j+n-1}\rangle\)</span>. Then, for <span class="math">\(1 \le i \le n\)</span>, <span class="math">\[s&#39;_i = s_{j+i-1} - s_{j-1}
      \begin{cases}
      &gt; 0 \text{ (by definition of $j$)} &amp; \text{when } j+i-1 &lt; n \\
      = s_n + s_{j+i-1-n}-s_{j-1} \ge s_n &gt; 0 &amp; \text{when } j+i-1 \ge n. \\
      \end{cases}\]</span> <span class="math">\(\Box\)</span></p>
      <p>Now we can assume without loss of generality that any sequence of real numbers <span class="math">\(\langle x_1, \ldots, x_n\rangle\)</span> with <span class="math">\(\sum x_i &gt; 0\)</span> is already shifted so that all its partial sums <span class="math">\(s_i &gt; 0\)</span> for <span class="math">\(i &gt; 0\)</span>. This allows us to provide a nice general expression for <span class="math">\(\sigma(x)\)</span>.</p>
      <p><strong>Property 4</strong>  <em>Suppose that <span class="math">\(x\)</span> is a finite real sequence with <span class="math">\(i^\text{th}\)</span> partial sum <span class="math">\(s_i\)</span>, and that <span class="math">\(s_i &gt; 0\)</span> for all <span class="math">\(i &gt; 0\)</span>. Then <span class="math">\[\sigma(x) = \#\left\{\min_{j \le i \le n} s_i\; \big|\; 1 \le j \le n \right\}.\]</span> More specifically, an index <span class="math">\(j\)</span> with <span class="math">\(1 \le j \le n\)</span> is a positive-sum shift iff <span class="math">\(s_{j-1} &lt; s_i\)</span> for all <span class="math">\(i\)</span> with <span class="math">\(j \le i \le n\)</span>.</em></p>
      <hr />
      <p><strong>Proof</strong>  We'll start by supposing we have an index <span class="math">\(j\)</span> with <span class="math">\(1 \le j \le n\)</span> and <span class="math">\(s_{j-1} &lt; s_i\)</span> for all <span class="math">\(i\)</span> with <span class="math">\(j \le i \le n\)</span>; our goal is to show that such a <span class="math">\(j\)</span> must be a positive-sum shift. Our approach will be similar to the proof of property 3.</p>
      <p>Let <span class="math">\(s&#39;_i\)</span> denote the <span class="math">\(i^\text{th}\)</span> partial sum of <span class="math">\(\langle x_j, \ldots, x_{j+n-1}\rangle\)</span>: <span class="math">\[s&#39;_i = \sum_{k=j}^{j+i-1}x_k.\]</span> Then <span class="math">\[s&#39;_i = s_{j+i-1} - s_{j-1} \begin{cases}
      &gt; 0 &amp; \text{if } j+i-1 \le n, \\
      = s_{j+i-1-n} + s_n - s_{j-1} &amp; \text{if } j+i-1 &gt; n; \\
      \end{cases}\]</span> the last inequality follows since <span class="math">\(s_{j+i-1-n} &gt; 0\)</span> and <span class="math">\(s_n &gt; s_{j-1}\)</span>.</p>
      <p>On the other hand, if <span class="math">\(s_{j-1}\ge s_i\)</span> for some <span class="math">\(i,j\)</span> with <span class="math">\(1\le j\le i\le n\)</span>, then <span class="math">\(s&#39;_{i-j+1}=s_i-s_{j-1}\le 0\)</span>, so that <span class="math">\(j\)</span> isn't a positive-sum shift. This completes the proof of the last part of the property; next we'll justify the expression for <span class="math">\(\sigma(x)\)</span>. <span class="math">\(\Box\)</span></p>
      <p>(Next: note why the specifically case matches the <span class="math">\(\sigma(x)\)</span> value; proof; example illustration for intuition)</p>
      <h1 id="random-sequences"><span class="header-section-number">3</span> Random sequences</h1>
      <p>Add more content here.</p>
      <div class="references">
      <h1 id="references" class="unnumbered">References</h1>
      <p>Knuth, Donald E., Oren Patashnik, and Ronald L. Graham. 1998. <em>Concrete Mathematics: A Foundation for Computer Science</em>. addison-wesley.</p>
      <p>Raney, George. 1960. “Functional Composition Patterns and Power Series Reversion.” <em>Transactions of the American Mathematical Society</em> 94: 441–51.</p>
      </div>
    </div>
  </body>
</html>
